<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infrastructure Console</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color Palette */
            --primary-color: #1f2937;
            --secondary-color: #374151;
            --accent-color: #4f46e5;
            --success-color: #059669;
            --warning-color: #d97706;
            --error-color: #dc2626;
            --maintenance-color: #6366f1;
            --hermes-color: #7c3aed;
            --snapshot-color: #0891b2;
            --restore-color: #0f766e;
            --etl-color: #059669;
            
            /* Backgrounds */
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f3f4f6;
            
            /* Text Colors */
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            
            /* Borders */
            --border-color: #e5e7eb;
            --border-hover: #d1d5db;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 0;
            box-shadow: var(--shadow-sm);
            width: 100%;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 2rem;
            font-size: 0.875rem;
        }

        /* Status Badge System */
        .status-badge,
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            width: fit-content;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border: 1px solid transparent;
        }

        .status-indicator {
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        /* Status Color Variants */
        .status-healthy, .status-synced, .status-running,
        .status-indicator.healthy {
            background: #f0fdf4;
            color: var(--success-color);
            border-color: #bbf7d0;
        }

        .status-catching.up {
            background: #f0f9ff;
            color: #0369a1;
            border-color: #bae6fd;
        }

        .status-unhealthy, .status-stopped, .status-failed,
        .status-indicator.error {
            background: #fef2f2;
            color: var(--error-color);
            border-color: #fecaca;
        }

        .status-maintenance,
        .status-indicator.maintenance {
            background: #eef2ff;
            color: var(--maintenance-color);
            border-color: #c7d2fe;
        }

        .status-unknown {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border-color: var(--border-color);
        }

        .status-indicator.warning {
            background: #fffbeb;
            color: var(--warning-color);
            border-color: #fed7aa;
        }

        .status-dot,
        .status-dot-mini {
            border-radius: 50%;
            background-color: currentColor;
        }

        .status-dot {
            width: 8px;
            height: 8px;
        }

        .status-dot-mini {
            width: 6px;
            height: 6px;
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-icon {
            width: 1.25rem;
            height: 1.25rem;
            color: var(--accent-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .metric-subtitle {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .progress-bar {
            margin-top: 1rem;
            height: 4px;
            background-color: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.5s ease;
            border-radius: 2px;
        }

        /* Panel System */
        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .panel-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-actions {
            display: flex;
            gap: 0.75rem;
        }

        .panel-content {
            padding: 0;
        }

        /* Table Styles */
        .infrastructure-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .infrastructure-table td {
            padding: 1.25rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        .infrastructure-table tbody tr:hover {
            background: var(--bg-tertiary);
        }

        /* Component Info Styles */
        .node-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .node-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .node-server {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .auto-restore-indicator {
            font-size: 0.7rem;
            color: var(--success-color);
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .status-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .block-height,
        .uptime,
        .response-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Schedule Display */
        .schedule-info,
        .next-run-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .schedule-item,
        .next-run-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .schedule-label,
        .next-run-label {
            font-size: 0.625rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .schedule-cron {
            font-size: 0.75rem;
            font-family: 'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.375rem;
            border-radius: 0.25rem;
            border: 1px solid var(--border-color);
        }

        .schedule-empty,
        .next-run-empty {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .next-run-time {
            font-size: 0.75rem;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.3;
        }

        /* Button System */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        .btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
        }

        .btn-icon {
            padding: 0.5rem;
        }

        /* Button Color Variants */
        .btn-primary {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .btn-primary:hover:not(:disabled) {
            background: #4338ca;
            border-color: #4338ca;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .btn-success:hover:not(:disabled) {
            background: #047857;
            border-color: #047857;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
            border-color: var(--warning-color);
        }

        .btn-warning:hover:not(:disabled) {
            background: #b45309;
            border-color: #b45309;
        }

        .btn-hermes {
            background: var(--hermes-color);
            color: white;
            border-color: var(--hermes-color);
        }

        .btn-hermes:hover:not(:disabled) {
            background: #6d28d9;
            border-color: #6d28d9;
        }

        .btn-snapshot {
            background: var(--snapshot-color);
            color: white;
            border-color: var(--snapshot-color);
        }

        .btn-snapshot:hover:not(:disabled) {
            background: #0e7490;
            border-color: #0e7490;
        }

        .btn-restore {
            background: var(--restore-color);
            color: white;
            border-color: var(--restore-color);
        }

        .btn-restore:hover:not(:disabled) {
            background: #134e4a;
            border-color: #134e4a;
        }

        .btn-etl {
            background: var(--etl-color);
            color: white;
            border-color: var(--etl-color);
        }

        .btn-etl:hover:not(:disabled) {
            background: #047857;
            border-color: #047857;
        }

        /* Loading & Empty States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-muted);
            flex-direction: column;
            gap: 1rem;
        }

        .spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            padding: 3rem;
            text-align: center;
            color: var(--text-muted);
        }

        .empty-state-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtitle {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .error-state {
            padding: 3rem;
            text-align: center;
            color: var(--error-color);
        }

        /* Alert System */
        .alert {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.25rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-width: 400px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            border: 1px solid;
        }

        .alert.show {
            opacity: 1;
            transform: translateX(0);
        }

        .alert-success {
            background: #f0fdf4;
            color: var(--success-color);
            border-color: #bbf7d0;
        }

        .alert-warning {
            background: #fffbeb;
            color: var(--warning-color);
            border-color: #fed7aa;
        }

        .alert-error {
            background: #fef2f2;
            color: var(--error-color);
            border-color: #fecaca;
        }

        /* Utility Classes */
        #last-updated {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 400;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>Infrastructure Console</h1>
            </div>
            <div class="header-status">
                <div class="status-indicator healthy" id="system-status">
                    <div class="status-dot"></div>
                    <span>All Systems Operational</span>
                </div>
                <div id="last-updated">Last updated: Never</div>
            </div>
        </div>
    </header>

    <main class="main-container">
        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Total Components</div>
                    <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                </div>
                <div class="metric-value" id="total-components">-</div>
                <div class="metric-subtitle" id="components-breakdown">Nodes, Relayers & ETL</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Operational Components</div>
                    <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                </div>
                <div class="metric-value" id="healthy-components">-</div>
                <div class="metric-subtitle" id="health-percentage">-% operational</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="health-progress" style="width: 0%"></div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Uptime Statistics</div>
                    <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/>
                    </svg>
                </div>
                <div class="metric-value" id="average-uptime">-</div>
                <div class="metric-subtitle" id="uptime-subtitle">Average uptime</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Server Count</div>
                    <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z"/>
                        <path d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V9a1 1 0 00-1-1h-1v4.5a1.5 1.5 0 01-3 0V7z"/>
                    </svg>
                </div>
                <div class="metric-value" id="server-count">-</div>
                <div class="metric-subtitle" id="server-subtitle">Infrastructure servers</div>
            </div>
        </div>

        <!-- Blockchain Nodes Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                    Blockchain Nodes
                </div>
                <div class="panel-actions">
                    <button class="btn btn-secondary btn-sm" onclick="app.refreshNodes()" title="Refresh all node statuses">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                        </svg>
                        Refresh All
                    </button>
                </div>
            </div>
            <div class="panel-content" id="nodes-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading blockchain nodes...</span>
                </div>
            </div>
        </div>

        <!-- Hermes Relayers Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
                    </svg>
                    Hermes Relayers
                </div>
                <div class="panel-actions">
                    <button class="btn btn-secondary btn-sm" onclick="app.refreshHermes()" title="Refresh all Hermes relayer statuses">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                        </svg>
                        Refresh All
                    </button>
                </div>
            </div>
            <div class="panel-content" id="hermes-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading Hermes relayers...</span>
                </div>
            </div>
        </div>

        <!-- ETL Services Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM4.586 8L6 9.414 7.414 8H4.586zM5 12a1 1 0 100 2h10a1 1 0 100-2H5z"/>
                    </svg>
                    ETL Services
                </div>
                <div class="panel-actions">
                    <button class="btn btn-secondary btn-sm" onclick="app.refreshEtl()" title="Refresh all ETL service statuses">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                        </svg>
                        Refresh All
                    </button>
                </div>
            </div>
            <div class="panel-content" id="etl-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading ETL services...</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        /**
         * Infrastructure Console Application
         * Modular architecture for better maintainability
         */
        const app = (() => {
            // ============================================================
            // STATE MANAGEMENT
            // ============================================================
            const state = {
                configs: {
                    nodes: {},
                    hermes: {},
                    etl: {}
                },
                data: {
                    nodes: null,
                    hermes: null,
                    etl: null,
                    maintenance: null
                },
                ui: {
                    isLoading: false,
                    refreshInterval: null
                }
            };

            // ============================================================
            // CONSTANTS
            // ============================================================
            const CONFIG = {
                REFRESH_INTERVAL: 30000,
                ALERT_DURATION: 5000,
                SERVER_TIMEZONE_OFFSET: 0 // UTC
            };

            // ============================================================
            // DOM CACHE
            // ============================================================
            const dom = {};

            function cacheDOMElements() {
                dom.systemStatus = document.getElementById('system-status');
                dom.lastUpdated = document.getElementById('last-updated');
                dom.totalComponents = document.getElementById('total-components');
                dom.healthyComponents = document.getElementById('healthy-components');
                dom.componentsBreakdown = document.getElementById('components-breakdown');
                dom.healthPercentage = document.getElementById('health-percentage');
                dom.healthProgress = document.getElementById('health-progress');
                dom.averageUptime = document.getElementById('average-uptime');
                dom.uptimeSubtitle = document.getElementById('uptime-subtitle');
                dom.serverCount = document.getElementById('server-count');
                dom.serverSubtitle = document.getElementById('server-subtitle');
                dom.nodesContainer = document.getElementById('nodes-container');
                dom.hermesContainer = document.getElementById('hermes-container');
                dom.etlContainer = document.getElementById('etl-container');
            }

            // ============================================================
            // API CLIENT
            // ============================================================
            const api = {
                async fetchJSON(url) {
                    const response = await fetch(url);
                    return response.json();
                },

                async loadConfigs() {
                    const [nodes, hermes, etl] = await Promise.all([
                        this.fetchJSON('/api/config/nodes'),
                        this.fetchJSON('/api/config/hermes'),
                        this.fetchJSON('/api/config/etl')
                    ]);
                    
                    state.configs.nodes = nodes.success ? (nodes.data.nodes || {}) : {};
                    state.configs.hermes = hermes.success ? (hermes.data.hermes || {}) : {};
                    state.configs.etl = etl.success ? (etl.data.etl || {}) : {};
                },

                async loadHealthData() {
                    const [nodes, hermes, etl, maintenance] = await Promise.all([
                        this.fetchJSON('/api/health/nodes?include_disabled=true'),
                        this.fetchJSON('/api/health/hermes'),
                        this.fetchJSON('/api/health/etl?include_disabled=true'),
                        this.fetchJSON('/api/operations/active')
                    ]);

                    state.data.nodes = nodes.success ? nodes.data : null;
                    state.data.hermes = hermes.success ? hermes.data : null;
                    state.data.etl = etl.success ? etl.data : null;
                    state.data.maintenance = maintenance.success ? maintenance.data : null;
                }
            };

            // ============================================================
            // UTILITIES
            // ============================================================
            const utils = {
                formatName(name) {
                    if (!name) return name;
                    return name.split('-')
                        .map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
                        .join(' ');
                },

                formatTimeAgo(timestamp) {
                    if (!timestamp) return 'Never';
                    const diffMs = Date.now() - new Date(timestamp);
                    const diffMins = Math.floor(diffMs / 60000);
                    
                    if (diffMins < 1) return 'Just now';
                    if (diffMins < 60) return `${diffMins}m ago`;
                    
                    const diffHours = Math.floor(diffMins / 60);
                    if (diffHours < 24) return `${diffHours}h ago`;
                    
                    const diffDays = Math.floor(diffHours / 24);
                    return `${diffDays}d ago`;
                },

                getStatusClass(status, type = 'node') {
                    const clean = status.toLowerCase().replace(/\s+/g, '').replace(/[()]/g, '');
                    
                    if (type === 'node') {
                        if (clean === 'synced' || clean === 'healthy') return 'status-synced';
                        if (clean === 'catchingup') return 'status-catching up';
                        if (clean === 'unhealthy') return 'status-unhealthy';
                        if (clean === 'maintenance') return 'status-maintenance';
                    } else if (type === 'hermes') {
                        if (clean.includes('running')) return 'status-running';
                        if (clean.includes('stopped') || clean.includes('failed')) return 'status-stopped';
                    } else if (type === 'etl') {
                        if (clean === 'healthy') return 'status-healthy';
                        if (clean === 'unhealthy') return 'status-unhealthy';
                    }
                    
                    return 'status-unknown';
                },

                getCronSortValue(cronSchedule) {
                    if (!cronSchedule) return 99999;
                    const parts = cronSchedule.trim().split(/\s+/);
                    if (parts.length !== 6) return 99999;
                    const hour = parseInt(parts[2]) || 0;
                    const dayOfWeek = parseInt(parts[5]) || 0;
                    return dayOfWeek * 100 + hour;
                }
            };

            // ============================================================
            // CRON PARSER
            // ============================================================
            const cron = {
                parse(expression) {
                    const parts = expression.trim().split(/\s+/);
                    if (parts.length !== 6) return null;
                    
                    return {
                        second: parts[0],
                        minute: parts[1],
                        hour: parts[2],
                        dayOfMonth: parts[3],
                        month: parts[4],
                        dayOfWeek: parts[5]
                    };
                },

                getNextRun(expression) {
                    const parsed = this.parse(expression);
                    if (!parsed) return null;

                    const now = new Date();
                    const next = new Date(now);

                    // Set seconds
                    next.setUTCSeconds(parsed.second !== '*' ? (parseInt(parsed.second) || 0) : 0, 0);

                    // Set minutes
                    if (parsed.minute !== '*') {
                        const targetMinute = parseInt(parsed.minute);
                        if (targetMinute >= 0 && targetMinute <= 59) {
                            next.setUTCMinutes(targetMinute);
                        }
                    }

                    // Set hours
                    if (parsed.hour !== '*') {
                        const targetHour = parseInt(parsed.hour);
                        if (targetHour >= 0 && targetHour <= 23) {
                            next.setUTCHours(targetHour);
                        }
                    }

                    // Handle day of week (1=Sunday system to JavaScript 0=Sunday)
                    if (parsed.dayOfWeek !== '*') {
                        const targetDayNum = parseInt(parsed.dayOfWeek);
                        const targetJSDay = targetDayNum === 1 ? 0 : targetDayNum - 1;
                        const currentJSDay = next.getUTCDay();
                        let daysToAdd = targetJSDay - currentJSDay;

                        if (daysToAdd < 0 || (daysToAdd === 0 && next <= now)) {
                            daysToAdd += 7;
                        }

                        if (daysToAdd > 0) {
                            next.setUTCDate(next.getUTCDate() + daysToAdd);
                        }
                    } else if (next <= now) {
                        next.setUTCDate(next.getUTCDate() + 1);
                    }

                    return next;
                },

                formatNextRun(cronSchedule) {
                    const nextRun = this.getNextRun(cronSchedule);
                    if (!nextRun) return '<div class="next-run-empty">Invalid schedule</div>';

                    const timeString = nextRun.toLocaleTimeString([], { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        hour12: true 
                    });
                    const dayString = nextRun.toLocaleDateString([], { weekday: 'long' });
                    const dateString = nextRun.toLocaleDateString([], { 
                        day: '2-digit', 
                        month: 'short' 
                    });

                    return `<div class="next-run-time">${timeString}, ${dayString}, ${dateString}</div>`;
                }
            };

            // ============================================================
            // TEMPLATE BUILDERS
            // ============================================================
            const templates = {
                icons: {
                    prune: '<svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 3a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3z"/></svg>',
                    snapshot: '<svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm12 12V8l-2 2-2-2v8h4z"/></svg>',
                    restore: '<svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/></svg>',
                    refresh: '<svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/></svg>'
                },

                scheduleItem(label, schedule, enabled = true) {
                    if (!enabled) {
                        return `<div class="schedule-item">
                            <div class="schedule-label">${label}</div>
                            <div class="schedule-empty">Disabled</div>
                        </div>`;
                    }
                    return `<div class="schedule-item">
                        <div class="schedule-label">${label}</div>
                        ${schedule ? `<div class="schedule-cron">${schedule}</div>` : '<div class="schedule-empty">Not scheduled</div>'}
                    </div>`;
                },

                nextRunItem(label, schedule, enabled = true) {
                    if (!enabled) {
                        return `<div class="next-run-item">
                            <div class="next-run-label">${label}</div>
                            <div class="next-run-empty">Disabled</div>
                        </div>`;
                    }
                    return `<div class="next-run-item">
                        <div class="next-run-label">${label}</div>
                        ${schedule ? cron.formatNextRun(schedule) : '<div class="next-run-empty">Not scheduled</div>'}
                    </div>`;
                },

                actionButton(type, nodeName, config) {
                    const buttons = {
                        prune: {
                            condition: config.pruning_enabled,
                            class: 'btn-warning',
                            icon: this.icons.prune,
                            title: 'Execute pruning operation - stops node, runs cosmos-pruner, restarts node',
                            onclick: `app.executeNodePruning('${nodeName}')`
                        },
                        snapshot: {
                            condition: config.snapshots_enabled,
                            class: 'btn-snapshot',
                            icon: this.icons.snapshot,
                            title: 'Create network snapshot - stops node, creates compressed backup, restarts node',
                            onclick: `app.executeCreateSnapshot('${nodeName}')`
                        },
                        restore: {
                            condition: config.auto_restore_enabled,
                            class: 'btn-restore',
                            icon: this.icons.restore,
                            title: 'Restore from latest network snapshot - replaces all data, preserves validator state',
                            onclick: `app.executeManualRestore('${nodeName}')`
                        }
                    };

                    const btn = buttons[type];
                    if (!btn || !btn.condition) return '';

                    return `<button class="btn btn-icon ${btn.class}" onclick="${btn.onclick}" title="${btn.title}">
                        ${btn.icon}
                    </button>`;
                },

                emptyState(title, subtitle) {
                    return `<div class="empty-state">
                        <div class="empty-state-title">${title}</div>
                        <div class="empty-state-subtitle">${subtitle}</div>
                    </div>`;
                },

                errorState(title, message) {
                    return `<div class="error-state">
                        <div class="empty-state-title">${title}</div>
                        <div class="empty-state-subtitle">${message}</div>
                    </div>`;
                }
            };

            // ============================================================
            // RENDERERS
            // ============================================================
            const renderers = {
                renderNodes(nodes) {
                    if (!nodes || nodes.length === 0) {
                        dom.nodesContainer.innerHTML = templates.emptyState(
                            'No blockchain nodes configured',
                            'Add node configurations to get started'
                        );
                        return;
                    }

                    const sorted = [...nodes].sort((a, b) => {
                        const configA = state.configs.nodes[a.node_name] || {};
                        const configB = state.configs.nodes[b.node_name] || {};
                        return utils.getCronSortValue(configA.pruning_schedule) - 
                               utils.getCronSortValue(configB.pruning_schedule);
                    });

                    const rows = sorted.map(node => {
                        const config = state.configs.nodes[node.node_name] || {};
                        return `<tr>
                            <td style="width: 20%;">
                                <div class="node-info">
                                    <div class="node-name">${utils.formatName(node.node_name)}</div>
                                    <div class="node-server">${node.server_host}</div>
                                    ${config.auto_restore_enabled ? '<div class="auto-restore-indicator">Auto restore</div>' : ''}
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="status-info">
                                    <div class="status-badge ${utils.getStatusClass(node.status, 'node')}">
                                        <div class="status-dot-mini"></div>
                                        ${node.status}
                                    </div>
                                    <div class="block-height">Block: ${node.latest_block_height ? node.latest_block_height.toLocaleString() : 'N/A'}</div>
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="schedule-info">
                                    ${templates.scheduleItem('Pruning', config.pruning_schedule)}
                                    ${templates.scheduleItem('Snapshot', config.snapshot_schedule, config.snapshots_enabled)}
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="next-run-info">
                                    ${templates.nextRunItem('Next Pruning', config.pruning_schedule)}
                                    ${templates.nextRunItem('Next Snapshot', config.snapshot_schedule, config.snapshots_enabled)}
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="action-buttons">
                                    ${templates.actionButton('prune', node.node_name, config)}
                                    ${templates.actionButton('snapshot', node.node_name, config)}
                                    ${templates.actionButton('restore', node.node_name, config)}
                                </div>
                            </td>
                        </tr>`;
                    }).join('');

                    dom.nodesContainer.innerHTML = `<table class="infrastructure-table"><tbody>${rows}</tbody></table>`;
                },

                renderHermes(instances) {
                    if (!instances || instances.length === 0) {
                        dom.hermesContainer.innerHTML = templates.emptyState(
                            'No Hermes relayers configured',
                            'Add Hermes configurations to get started'
                        );
                        return;
                    }

                    const sorted = [...instances].sort((a, b) => {
                        const configA = state.configs.hermes[a.name] || {};
                        const configB = state.configs.hermes[b.name] || {};
                        return utils.getCronSortValue(configA.restart_schedule) - 
                               utils.getCronSortValue(configB.restart_schedule);
                    });

                    const rows = sorted.map(hermes => {
                        const config = state.configs.hermes[hermes.name] || {};
                        return `<tr>
                            <td style="width: 25%;">
                                <div class="node-info">
                                    <div class="node-name">${utils.formatName(hermes.name)}</div>
                                    <div class="node-server">${hermes.server_host}</div>
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="status-badge ${utils.getStatusClass(hermes.status, 'hermes')}">
                                    <div class="status-dot-mini"></div>
                                    ${hermes.status.replace(/[()]/g, '')}
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="schedule-info">
                                    ${templates.scheduleItem('Restart Schedule', config.restart_schedule)}
                                </div>
                            </td>
                            <td style="width: 15%;">
                                <div class="next-run-info">
                                    ${templates.nextRunItem('Next Restart', config.restart_schedule)}
                                </div>
                            </td>
                            <td style="width: 20%;">
                                <div class="action-buttons">
                                    <button class="btn btn-icon btn-hermes" onclick="app.executeHermesRestart('${hermes.name}')" title="Restart Hermes relayer">
                                        ${templates.icons.restore}
                                    </button>
                                </div>
                            </td>
                        </tr>`;
                    }).join('');

                    dom.hermesContainer.innerHTML = `<table class="infrastructure-table"><tbody>${rows}</tbody></table>`;
                },

                renderEtl(services) {
                    if (!services || services.length === 0) {
                        dom.etlContainer.innerHTML = templates.emptyState(
                            'No ETL services configured',
                            'Add ETL service configurations to get started'
                        );
                        return;
                    }

                    const rows = services.map(etl => `<tr>
                        <td style="width: 25%;">
                            <div class="node-info">
                                <div class="node-name">${utils.formatName(etl.service_name)}</div>
                                <div class="node-server">${etl.server_host}</div>
                                ${etl.description ? `<div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem;">${etl.description}</div>` : ''}
                            </div>
                        </td>
                        <td style="width: 20%;">
                            <div class="status-info">
                                <div class="status-badge ${utils.getStatusClass(etl.status, 'etl')}">
                                    <div class="status-dot-mini"></div>
                                    ${etl.status}
                                </div>
                                ${etl.status_code ? `<div class="block-height">Status: ${etl.status_code}</div>` : ''}
                            </div>
                        </td>
                        <td style="width: 25%;">
                            <div class="node-info">
                                <div style="font-size: 0.75rem; color: var(--text-muted); font-family: monospace;">${etl.service_url}</div>
                                ${etl.response_time_ms ? `<div class="response-time">${etl.response_time_ms}ms response</div>` : ''}
                            </div>
                        </td>
                        <td style="width: 20%;">
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${utils.formatTimeAgo(etl.last_check)}</div>
                            ${etl.error_message ? `<div style="font-size: 0.7rem; color: var(--error-color); margin-top: 0.25rem;">${etl.error_message}</div>` : ''}
                        </td>
                        <td style="width: 10%;">
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-etl" onclick="app.refreshEtlService('${etl.service_name}')" title="Refresh ETL service health">
                                    ${templates.icons.refresh}
                                </button>
                            </div>
                        </td>
                    </tr>`).join('');

                    dom.etlContainer.innerHTML = `<table class="infrastructure-table"><tbody>${rows}</tbody></table>`;
                }
            };

            // ============================================================
            // METRICS UPDATER
            // ============================================================
            const metrics = {
                update() {
                    this.updateHealth();
                    this.updateUptime();
                    this.updateServers();
                    this.updateSystemStatus();
                },

                updateHealth() {
                    const counts = this.getCounts();
                    const healthPct = counts.total > 0 ? Math.round((counts.operational / counts.total) * 100) : 0;

                    dom.totalComponents.textContent = counts.total;
                    dom.healthyComponents.textContent = counts.operational;
                    dom.componentsBreakdown.textContent = `${counts.nodes} Nodes, ${counts.hermes} Relayers & ${counts.etl} ETL`;
                    dom.healthPercentage.textContent = `${healthPct}% operational`;
                    dom.healthProgress.style.width = `${healthPct}%`;
                },

                updateUptime() {
                    const counts = this.getCounts();
                    const uptimePct = counts.total > 0 ? Math.round((counts.operational / counts.total) * 100) : 0;

                    dom.averageUptime.textContent = `${uptimePct}%`;
                    dom.uptimeSubtitle.textContent = 'System availability';
                },

                updateServers() {
                    const servers = new Set();
                    
                    [state.data.nodes, state.data.hermes, state.data.etl].forEach(dataset => {
                        if (dataset) {
                            dataset.forEach(item => {
                                if (item.server_host) servers.add(item.server_host);
                            });
                        }
                    });

                    dom.serverCount.textContent = servers.size;
                    dom.serverSubtitle.textContent = 'Infrastructure servers';
                },

                updateSystemStatus() {
                    const counts = this.getCounts();
                    const healthPct = counts.total > 0 ? Math.round((counts.operational / counts.total) * 100) : 0;

                    if (counts.maintenance > 0) {
                        dom.systemStatus.className = 'status-indicator maintenance';
                        dom.systemStatus.querySelector('span').textContent = 
                            `${counts.maintenance} System${counts.maintenance === 1 ? '' : 's'} in Maintenance`;
                    } else if (healthPct === 100) {
                        dom.systemStatus.className = 'status-indicator healthy';
                        dom.systemStatus.querySelector('span').textContent = 'All Systems Operational';
                    } else if (healthPct >= 80) {
                        dom.systemStatus.className = 'status-indicator warning';
                        dom.systemStatus.querySelector('span').textContent = 'Minor Issues Detected';
                    } else {
                        dom.systemStatus.className = 'status-indicator error';
                        dom.systemStatus.querySelector('span').textContent = 'System Issues Detected';
                    }
                },

                getCounts() {
                    const nodes = state.data.nodes || [];
                    const hermes = state.data.hermes || [];
                    const etl = state.data.etl || [];

                    const operationalNodes = nodes.filter(n => {
                        const s = n.status.toLowerCase();
                        return s === 'synced' || s === 'catching up' || s === 'healthy';
                    }).length;

                    const operationalHermes = hermes.filter(h => 
                        utils.getStatusClass(h.status, 'hermes') === 'status-running'
                    ).length;

                    const operationalEtl = etl.filter(e => 
                        e.status.toLowerCase() === 'healthy'
                    ).length;

                    const maintenanceNodes = nodes.filter(n => 
                        n.status.toLowerCase() === 'maintenance'
                    ).length;

                    return {
                        nodes: nodes.length,
                        hermes: hermes.length,
                        etl: etl.length,
                        total: nodes.length + hermes.length + etl.length,
                        operational: operationalNodes + operationalHermes + operationalEtl,
                        maintenance: maintenanceNodes
                    };
                }
            };

            // ============================================================
            // UI HELPERS
            // ============================================================
            const ui = {
                showAlert(message, type = 'success') {
                    const alert = document.createElement('div');
                    alert.className = `alert alert-${type}`;
                    alert.textContent = message;
                    document.body.appendChild(alert);

                    setTimeout(() => alert.classList.add('show'), 100);
                    setTimeout(() => {
                        alert.classList.remove('show');
                        setTimeout(() => alert.remove(), 300);
                    }, CONFIG.ALERT_DURATION);
                },

                updateLastUpdated() {
                    dom.lastUpdated.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                },

                confirm(title, message) {
                    return window.confirm(`${title}\n\n${message}`);
                }
            };

            // ============================================================
            // PUBLIC API
            // ============================================================
            return {
                async init() {
                    cacheDOMElements();
                    await this.loadAllData();
                    this.startAutoRefresh();
                },

                async loadAllData() {
                    if (state.ui.isLoading) return;
                    state.ui.isLoading = true;

                    try {
                        await api.loadConfigs();
                        await api.loadHealthData();
                        
                        renderers.renderNodes(state.data.nodes);
                        renderers.renderHermes(state.data.hermes);
                        renderers.renderEtl(state.data.etl);
                        
                        metrics.update();
                        ui.updateLastUpdated();
                    } catch (error) {
                        console.error('Failed to load data:', error);
                        ui.showAlert('Failed to load data: ' + error.message, 'error');
                    } finally {
                        state.ui.isLoading = false;
                    }
                },

                startAutoRefresh() {
                    if (state.ui.refreshInterval) {
                        clearInterval(state.ui.refreshInterval);
                    }
                    state.ui.refreshInterval = setInterval(() => this.loadAllData(), CONFIG.REFRESH_INTERVAL);
                },

                // Public refresh methods
                async refreshNodes() {
                    ui.showAlert('Refreshing nodes...', 'warning');
                    await api.loadHealthData();
                    renderers.renderNodes(state.data.nodes);
                    metrics.update();
                    ui.showAlert('Nodes refreshed', 'success');
                },

                async refreshHermes() {
                    ui.showAlert('Refreshing Hermes...', 'warning');
                    await api.loadHealthData();
                    renderers.renderHermes(state.data.hermes);
                    metrics.update();
                    ui.showAlert('Hermes refreshed', 'success');
                },

                async refreshEtl() {
                    ui.showAlert('Refreshing ETL services...', 'warning');
                    await api.loadHealthData();
                    renderers.renderEtl(state.data.etl);
                    metrics.update();
                    ui.showAlert('ETL services refreshed', 'success');
                },

                async refreshEtlService(serviceName) {
                    try {
                        ui.showAlert(`Refreshing ${utils.formatName(serviceName)}...`, 'warning');
                        await api.fetchJSON(`/api/health/etl/${serviceName}`);
                        await api.loadHealthData();
                        renderers.renderEtl(state.data.etl);
                        ui.showAlert(`${utils.formatName(serviceName)} refreshed`, 'success');
                    } catch (error) {
                        ui.showAlert(`Failed to refresh: ${error.message}`, 'error');
                    }
                },

                // Action methods
                async executeCreateSnapshot(nodeName) {
                    const name = utils.formatName(nodeName);
                    if (!ui.confirm('Create Snapshot Confirmation',
                        `Create snapshot for ${name}?\n\n` +
                        'This will stop the node service\n' +
                        'Data will be compressed\n' +
                        'Service will be restarted\n' +
                        'This may take 30-120 minutes\n\n' +
                        'Proceed with snapshot creation?')) return;

                    try {
                        ui.showAlert(`Creating snapshot for ${name}...`, 'warning');
                        const data = await api.fetchJSON(`/api/snapshots/${nodeName}/create`);
                        if (data.success) {
                            ui.showAlert(`Snapshot created for ${name}`, 'success');
                            await this.loadAllData();
                        } else {
                            throw new Error(data.message || 'Snapshot creation failed');
                        }
                    } catch (error) {
                        ui.showAlert(`Failed to create snapshot: ${error.message}`, 'error');
                    }
                },

                async executeNodePruning(nodeName) {
                    const name = utils.formatName(nodeName);
                    if (!ui.confirm('Execute Pruning Confirmation',
                        `Start pruning for ${name}?\n\n` +
                        'This will:\n' +
                        '- Stop the node service\n' +
                        '- Run the cosmos-pruner tool\n' +
                        '- Start the service after completion\n' +
                        '- May take several hours\n\n' +
                        'Proceed with pruning?')) return;

                    try {
                        ui.showAlert(`Starting pruning for ${name}...`, 'warning');
                        const response = await fetch(`/api/maintenance/nodes/${nodeName}/prune`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const data = await response.json();
                        if (data.success) {
                            ui.showAlert(`Pruning started for ${name}`, 'success');
                            await this.loadAllData();
                        } else {
                            throw new Error(data.message || 'Pruning failed');
                        }
                    } catch (error) {
                        ui.showAlert(`Failed to start pruning: ${error.message}`, 'error');
                    }
                },

                async executeManualRestore(nodeName) {
                    const name = utils.formatName(nodeName);
                    if (!ui.confirm('Restore from Snapshot Confirmation',
                        `Restore ${name} from latest snapshot?\n\n` +
                        'WARNING: This will:\n' +
                        '- Stop the node service\n' +
                        '- Delete ALL current data & wasm directories\n' +
                        '- Extract latest snapshot to replace data\n' +
                        '- Restore validator state\n' +
                        '- Start the service after completion\n' +
                        '- May take 30-60 minutes\n\n' +
                        'This action CANNOT BE UNDONE.\n\n' +
                        'Proceed with restore?')) return;

                    try {
                        ui.showAlert(`Restoring ${name}...`, 'warning');
                        const response = await fetch(`/api/snapshots/${nodeName}/restore`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const data = await response.json();
                        if (data.success) {
                            ui.showAlert(`${name} restored successfully`, 'success');
                            await this.loadAllData();
                        } else {
                            throw new Error(data.message || 'Restore failed');
                        }
                    } catch (error) {
                        ui.showAlert(`Failed to restore: ${error.message}`, 'error');
                    }
                },

                async executeHermesRestart(hermesName) {
                    const name = utils.formatName(hermesName);
                    if (!ui.confirm('Restart Hermes Confirmation',
                        `Restart ${name}?\n\n` +
                        'This will stop and start the Hermes relayer\n' +
                        'The relayer will be temporarily unavailable\n\n' +
                        'Proceed with restart?')) return;

                    try {
                        ui.showAlert(`Restarting ${name}...`, 'warning');
                        const response = await fetch(`/api/maintenance/hermes/${hermesName}/restart`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        const data = await response.json();
                        if (data.success) {
                            ui.showAlert(`${name} restarted successfully`, 'success');
                            await this.loadAllData();
                        } else {
                            throw new Error(data.message || 'Restart failed');
                        }
                    } catch (error) {
                        ui.showAlert(`Failed to restart: ${error.message}`, 'error');
                    }
                }
            };
        })();

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
